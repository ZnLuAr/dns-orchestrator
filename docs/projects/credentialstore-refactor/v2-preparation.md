# v2.0.0 发布准备清单

**目标版本**: v2.0.0
**计划发布**: TBD
**状态**: 📝 规划中

## 概述

v2.0.0 是一个主要版本升级，将移除 v1.7.0 引入的数据迁移兼容代码，并可能引入其他破坏性变更。

**重要提示**: 此版本不支持从 v1.6.x 直接升级，用户必须先升级到 v1.7.x。

## 📋 准备工作清单

### 阶段 1: 代码清理与重构

#### 1.1 移除迁移兼容代码 ⚠️ 破坏性变更

**状态**: ⏸️ 待开始

**详细计划**: [v2-cleanup.md](./v2-cleanup.md)

**任务清单**:

- [ ] 删除 `ProviderCredentials::from_map()` 和 `to_map()` 方法
- [ ] 删除 `LegacyCredentialsMap` 类型别名（2 处）
- [ ] 删除 `migration_service.rs` 文件及相关导入
- [ ] 删除启动流程中的迁移代码块
- [ ] 删除 `StorageFormat` 格式检测枚举
- [ ] 简化 Adapter 的反序列化方法
- [ ] 删除迁移相关错误类型（2 个错误变体 + 2 处映射）
- [ ] 可选：删除 `load_raw_json()` 和 `save_raw_json()` 方法

**影响评估**:
- 移除约 300 行代码
- 启动时间减少约 50-100ms（无需格式检测）
- v1.6.x 用户无法直接升级

#### 1.2 其他破坏性变更（待定）

**状态**: 📝 待收集

如果有其他计划在 v2.0.0 引入的 API 变更，在此列出。

- [ ] （待添加）

### 阶段 2: 测试计划

#### 2.1 功能测试

**状态**: ⏸️ 待开始

- [ ] 创建账户功能测试（所有 4 个 provider）
- [ ] 更新账户功能测试
- [ ] 删除账户功能测试
- [ ] 账户导入导出功能测试
- [ ] 启动时账户恢复测试
- [ ] DNS 记录 CRUD 操作测试
- [ ] Toolbox 所有工具测试

#### 2.2 升级路径测试

**状态**: ⏸️ 待开始

测试场景：

- [ ] v1.7.0 → v2.0.0 升级（应成功，无数据丢失）
- [ ] v1.7.1 → v2.0.0 升级（应成功，无数据丢失）
- [ ] v1.6.x → v2.0.0 升级（应失败，给出明确错误提示）

#### 2.3 平台兼容性测试

**状态**: ⏸️ 待开始

- [ ] macOS (Apple Silicon)
- [ ] macOS (Intel)
- [ ] Windows (x64)
- [ ] Windows (ARM64)
- [ ] Linux (x64)
- [ ] Linux (ARM64)
- [ ] Android

#### 2.4 回归测试

**状态**: ⏸️ 待开始

- [ ] 运行所有单元测试：`cargo test --workspace`
- [ ] 运行前端测试（如果有）
- [ ] 手动回归测试核心功能

### 阶段 3: 文档更新

#### 3.1 用户文档

**状态**: ⏸️ 待开始

- [ ] 更新 README.md（版本号、新功能说明）
- [ ] 更新升级指南，强调 v1.6.x 用户必须先升级到 v1.7.x
- [ ] 更新 FAQ（如果有）

#### 3.2 开发者文档

**状态**: ⏸️ 待开始

- [ ] 更新 ARCHITECTURE.md（如有架构变更）
- [ ] 更新 DEVELOPMENT.md（如有开发流程变更）
- [ ] 更新 CLAUDE.md（如有 AI 辅助规则变更）

#### 3.3 API 文档

**状态**: ⏸️ 待开始

- [ ] 更新 Tauri 命令文档（如有变更）
- [ ] 更新 Core 库文档（rustdoc）
- [ ] 更新 Provider 库文档（rustdoc）

### 阶段 4: CHANGELOG 和 Release Notes

#### 4.1 CHANGELOG.md

**状态**: ⏸️ 待开始

创建 v2.0.0 条目，包含：

- [ ] **Breaking Changes** 章节（重点标注）
- [ ] **New Features** 章节（如有）
- [ ] **Improvements** 章节
- [ ] **Bug Fixes** 章节
- [ ] **Internal Changes** 章节

**Breaking Changes 必须包含**:
- 移除 v1.6.x 迁移支持
- 不支持从 v1.6.x 直接升级的说明
- 升级路径指引

#### 4.2 GitHub Release Notes

**状态**: ⏸️ 待开始

草稿 Release Notes 模板：

```markdown
# v2.0.0 - 主要版本升级

## ⚠️ 重要提示

**破坏性变更**: v2.0.0 不支持从 v1.6.x 直接升级！

- ❌ v1.6.x → v2.0.0 **不支持**
- ✅ v1.6.x → v1.7.x → v2.0.0 **支持**
- ✅ v1.7.x → v2.0.0 **支持**

**如果您正在使用 v1.6.x**，请先升级到 v1.7.x，再升级到 v2.0.0。

## 🗑️ 移除的功能

- 移除了 v1.7.0 引入的数据迁移兼容代码
- 移除了 `MigrationService` 和相关迁移逻辑
- 移除了 `LegacyCredentialsMap` 类型别名

## ✨ 改进

- 启动速度提升（无需格式检测和迁移）
- 代码简化，移除约 300 行兼容代码
- 更清晰的类型定义

## 📦 下载

（构建产物链接）

## 📝 完整更新日志

详见 [CHANGELOG.md](./CHANGELOG.md#v200)
```

- [ ] 完成 Release Notes 草稿
- [ ] 技术审核
- [ ] 用户语言审核（确保清晰易懂）

### 阶段 5: 用户沟通

#### 5.1 提前通知

**状态**: ⏸️ 待开始

**时机**: v2.0.0 发布前 2-4 周

- [ ] 在 v1.7.x release notes 中强调 v2.0.0 计划
- [ ] 在 GitHub Discussions 发布公告
- [ ] 更新项目 README 的显眼位置添加升级提示

#### 5.2 版本检测与错误提示

**状态**: 📝 待评估

**可选功能**: 在 v2.0.0 启动时检测旧格式数据并给出友好错误提示

示例实现：

```rust
// 在启动时检测
match credential_store.load_all().await {
    Ok(_) => { /* 正常启动 */ },
    Err(CoreError::SerializationError(_)) => {
        // 检测是否为旧格式
        if Self::is_legacy_format().await {
            eprintln!("错误：检测到 v1.6.x 格式的数据");
            eprintln!("v2.0.0 不支持从 v1.6.x 直接升级");
            eprintln!("请先升级到 v1.7.x，再升级到 v2.0.0");
            std::process::exit(1);
        }
    },
    Err(e) => return Err(e),
}
```

- [ ] 设计错误检测逻辑
- [ ] 实现友好的错误提示
- [ ] 添加升级指南链接

### 阶段 6: 版本号更新

#### 6.1 更新版本号

**状态**: ⏸️ 待开始

- [ ] 更新 `package.json` → `"version": "2.0.0"`
- [ ] 运行 `pnpm sync-version`（同步到所有配置文件）
- [ ] 验证版本号已同步到：
  - [ ] `src-tauri/tauri.conf.json`
  - [ ] `src-tauri/Cargo.toml`
  - [ ] `src-actix-web/Cargo.toml`

#### 6.2 更新依赖版本

**状态**: ⏸️ 待开始

- [ ] 检查并更新过时的依赖：`cargo outdated`
- [ ] 运行 `cargo update`
- [ ] 测试依赖更新后的兼容性

### 阶段 7: 构建与发布

#### 7.1 预发布测试

**状态**: ⏸️ 待开始

- [ ] 创建 `v2.0.0-beta.1` 预发布版本
- [ ] 在所有平台上测试 beta 版本
- [ ] 收集用户反馈
- [ ] 修复发现的问题

#### 7.2 生产构建

**状态**: ⏸️ 待开始

- [ ] 确认所有清单项完成
- [ ] 在本地进行最终测试
- [ ] 创建 git tag: `git tag v2.0.0`
- [ ] 推送 tag: `git push origin v2.0.0`
- [ ] 等待 GitHub Actions 完成构建

#### 7.3 发布检查

**状态**: ⏸️ 待开始

- [ ] 验证所有平台构建成功
- [ ] 下载并测试构建产物
- [ ] 编辑 GitHub Release（从 draft 到 published）
- [ ] 验证自动更新器正常工作

#### 7.4 发布后监控

**状态**: ⏸️ 待开始

- [ ] 监控 GitHub Issues 中的 bug 报告
- [ ] 监控用户升级反馈
- [ ] 准备 hotfix 流程（如有紧急问题）

## 📊 进度跟踪

| 阶段 | 任务总数 | 已完成 | 进度 | 状态 |
|------|---------|--------|------|------|
| 1. 代码清理与重构 | 9 | 0 | 0% | ⏸️ 待开始 |
| 2. 测试计划 | 15 | 0 | 0% | ⏸️ 待开始 |
| 3. 文档更新 | 9 | 0 | 0% | ⏸️ 待开始 |
| 4. CHANGELOG 和 Release Notes | 7 | 0 | 0% | ⏸️ 待开始 |
| 5. 用户沟通 | 5 | 0 | 0% | ⏸️ 待开始 |
| 6. 版本号更新 | 7 | 0 | 0% | ⏸️ 待开始 |
| 7. 构建与发布 | 11 | 0 | 0% | ⏸️ 待开始 |
| **总计** | **63** | **0** | **0%** | ⏸️ 待开始 |

## 🔗 相关文档

- [v2.0.0 代码清理计划](./v2-cleanup.md) - 详细的代码删除清单
- [v1.7.0 实施记录](./implementation.md) - 迁移功能的实现细节
- [项目概述](./README.md) - CredentialStore 重构项目概述

## 📅 时间线（草稿）

1. **准备阶段**（2-3 周）
   - 完成代码清理
   - 完成测试计划
   - 完成文档更新

2. **测试阶段**（1-2 周）
   - 发布 beta 版本
   - 收集反馈
   - 修复问题

3. **发布前准备**（1 周）
   - 完成 Release Notes
   - 用户沟通
   - 最终审核

4. **正式发布**
   - 创建 tag
   - 构建发布
   - 发布后监控

**预计总时间**: 4-6 周

---

**最后更新**: 2026-01-01
**负责人**: TBD
**审核人**: TBD
