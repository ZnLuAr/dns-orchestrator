# 升级指南

本指南帮助你安全地将 DNS Orchestrator 升级到最新版本。

## 📋 版本兼容性

### 支持的升级路径

| 源版本 | 目标版本 | 支持情况 | 说明 |
|--------|----------|----------|------|
| v1.6.x | v1.7.x | ✅ 自动迁移 | 启动时自动执行数据格式迁移 |
| v1.7.x | v2.0.x | ✅ 无需迁移 | 数据格式相同，直接升级 |
| v1.6.x | v2.0.x | ❌ **不支持** | 必须先升级到 v1.7.x |

### 推荐升级路径

```
v1.6.x → v1.7.x → v2.0.x ✅

v1.6.x → v2.0.x ❌ (数据丢失风险)
```

## 🚀 升级步骤

### 通用升级步骤

1. **备份数据**（重要！）
   - 导出所有账户：设置 → 导入/导出 → 导出账户
   - 保存导出文件到安全位置

2. **检查当前版本**
   - 打开 DNS Orchestrator
   - 设置 → 关于，查看当前版本号

3. **下载新版本**
   - 访问 [Releases 页面](https://github.com/AptS-1547/dns-orchestrator/releases)
   - 下载对应平台的安装包

4. **安装新版本**
   - 关闭当前运行的 DNS Orchestrator
   - 安装下载的新版本

5. **验证升级**
   - 启动新版本
   - 检查账户和域名是否正常显示
   - 测试 DNS 记录操作

### 从 v1.6.x 升级到 v1.7.x

**自动数据迁移**：v1.7.0 会在首次启动时自动迁移凭证数据格式。

**步骤**：

1. 备份数据（导出所有账户）
2. 安装 v1.7.x
3. 首次启动时，应用会自动执行迁移
4. 查看日志确认迁移成功：
   ```
   凭证迁移成功：X 个账户已迁移
   ```
5. 如果有账户迁移失败，会显示为 Error 状态
6. 对于失败的账户，手动重新输入凭证即可

**注意事项**：
- 迁移过程通常在 1 秒内完成
- 迁移失败的账户不会影响其他账户
- 可以手动修复失败的账户

### 从 v1.7.x 升级到 v2.0.x

**无需数据迁移**：v1.7.x 和 v2.0.x 使用相同的数据格式。

**步骤**：

1. 备份数据（可选，推荐）
2. 安装 v2.0.x
3. 正常启动，无需额外操作

**注意事项**：
- 如果你从 v1.6.x 直接升级到 v2.0.x，数据将无法读取
- 请确保已先升级到 v1.7.x

## ❌ 不支持的升级路径

### 从 v1.6.x 直接升级到 v2.0.x

**问题**：v2.0.0 移除了数据迁移功能，无法读取 v1.6.x 的旧格式数据。

**如果你已经升级**：
1. 卸载 v2.0.x
2. 下载并安装 v1.7.x
3. 导入之前导出的数据文件
4. 再升级到 v2.0.x

**正确做法**：
```
v1.6.x → 导出数据 → 升级到 v1.7.x → 验证数据 → 升级到 v2.0.x
```

## 🔧 故障排查

### 升级后账户显示为 Error 状态

**原因**：凭证迁移失败或凭证验证失败

**解决方案**：
1. 点击账户 → 编辑
2. 重新输入凭证
3. 保存并验证

### 升级后数据丢失

**原因**：可能是从 v1.6.x 直接升级到 v2.0.x

**解决方案**：
1. 降级到 v1.7.x
2. 导入之前导出的备份文件
3. 验证数据完整性
4. 再升级到 v2.0.x

### 自动更新失败

**Windows/Linux**：
- 检查是否有足够的磁盘空间
- 尝试手动下载安装包

**macOS**：
- 检查 Gatekeeper 设置
- 系统偏好设置 → 安全性与隐私 → 允许从以下位置下载的应用

**Android**：
- 检查存储权限
- 手动下载 APK 安装

## 📝 版本特定说明

### v1.7.0

**重要变更**：
- 凭证存储格式升级（自动迁移）
- 支持类型安全的凭证验证

**升级建议**：
- 所有 v1.6.x 用户强烈建议升级
- 为升级到 v2.0.x 做准备

### v2.0.0

**破坏性变更**：
- 移除 v1.6.x 迁移支持
- 移除旧的迁移代码

**升级要求**：
- 必须先升级到 v1.7.x
- 建议在 v1.7.x 运行一段时间后再升级

## 🔗 相关资源

- [发行说明](../release-notes/) - 查看各版本的详细更新内容
- [故障排查](./troubleshooting.md) - 常见问题解决方案
- [GitHub Issues](https://github.com/AptS-1547/dns-orchestrator/issues) - 报告问题

---

**返回**: [用户指南](./README.md) | [文档中心](../README.md)

**最后更新**: 2026-01-01
