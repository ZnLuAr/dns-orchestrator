# v1.4.1 发行说明

## 概述

v1.4.1 是一个改进版本，重点优化了华为云错误处理、更新了依赖项安全性，并为批量 DNS 记录操作奠定了基础架构。本版本显著提升了华为云服务的错误诊断能力，并为未来的批量操作功能做好准备。

## 新增功能

### 批量 DNS 记录操作框架

为未来的批量操作功能建立了完整的类型系统和接口定义：

- **新增 API 接口**：
  - `batch_create_records()` - 批量创建 DNS 记录
  - `batch_update_records()` - 批量更新 DNS 记录
  - `batch_delete_records()` - 批量删除 DNS 记录

- **类型定义**：
  - `BatchCreateResult` / `BatchCreateFailure` - 批量创建结果
  - `BatchUpdateResult` / `BatchUpdateFailure` - 批量更新结果
  - `BatchDeleteResult` / `BatchDeleteFailure` - 批量删除结果

- **实现计划**：
  - **Cloudflare**：使用批量 API，预期性能提升 850 倍（10,000 条记录）
  - **DNSPod**：使用 `CreateRecordBatch` / `ModifyRecordBatch` 异步任务 API
  - **阿里云**：调研批量 API 支持
  - **华为云**：使用 `BatchUpdateRecordSetWithLine` API

当前为占位实现，包含详细的文档和 TODO 列表，为后续各 Provider 的具体实现提供清晰指引。

## 优化改进

### 华为云错误码映射

**改进内容**：

- 错误码覆盖从基础映射扩展到 **29 个核心错误码**
- 新增 6 大错误分类系统：
  - **认证错误** (7 个)：APIGW.0301, APIGW.0101, DNS.0005 等
  - **权限拒绝** (4 个)：APIGW.0302, DNS.0030, DNS.1802 等
  - **配额超限** (8 个)：DNS.0403, DNS.0404, APIGW.0308 等
  - **记录操作** (4 个)：DNS.0312, DNS.0335, DNS.0016 等
  - **域名操作** (6 个)：DNS.0302, DNS.1206, DNS.0209 等
  - **网络错误** (5 个)：APIGW.0201, DNS.0012, DNS.0015 等
- 添加详细的错误码分类注释和官方文档链接
- 明确标注未映射的特殊功能（健康检查、VPC、DNSSEC 等）

**收益**：

- 错误信息更加精确，便于快速定位问题
- 提升华为云服务的用户体验
- 降低问题排查时间

**参考文档**：[华为云 DNS 错误码](https://support.huaweicloud.com/api-dns/ErrorCode.html)

### 日志系统优化

**改进内容**：

- 日志插件按构建模式分别设置输出级别：
  - **Debug 模式**：`debug` 级别，输出详细调试信息
  - **Release 模式**：`warn` 级别，仅输出警告和错误
- 修正 Tauri `CoreError` 到 `DnsError` 的转换逻辑，避免重复分支

**收益**：

- 开发环境获得更详细的日志，便于调试
- 生产环境减少日志噪音，提升性能
- 日志输出更加可控和合理

### 依赖项安全更新

**Rust 依赖更新**：

- `asn1-rs`：0.6.2 → 0.7.1
- `der-parser`：9.0.0 → 10.0.0
- `x509-parser`：0.16.0 → 0.18.0
- `oid-registry`：0.7.1 → 0.8.1
- `rand`：0.8 → 0.9
- 统一 `webpki-roots` 版本到 1.0.4
- `sea-orm` 系列：2.0.0-rc.20 → 2.0.0-rc.21

**前端工具更新**：

- `@biomejs/biome`：2.3.8 → 2.3.9

**API 适配**：

- 适配 `rand 0.9` API 变化：`rand::thread_rng().fill_bytes()` → `rand::rng().fill_bytes()`

**收益**：

- 修复已知安全漏洞
- 保持与最新 API 兼容
- 提升整体系统稳定性

## 技术统计

- **修改文件**：17 个
- **新增代码**：+355 行
- **删除代码**：-182 行
- **净增加**：+173 行

**主要变更分布**：

- 华为云错误码映射：+181 行
- 批量操作框架：+125 行
- 依赖项更新：~250 行（版本号更新）
- 日志配置优化：+23 行

## 破坏性变更

**无破坏性变更** - 本版本保持完全向后兼容：

- 所有现有 API 保持不变
- 批量操作接口为新增功能（占位实现）
- 依赖项更新无需用户干预
- 数据库结构无变化

## 升级说明

从 v1.4.0 升级无需额外操作，直接安装新版本即可。

**推荐升级用户**：

- 华为云用户建议升级以获得更好的错误诊断体验
- 所有用户建议升级以获得最新的安全更新
